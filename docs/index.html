<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
		<!-- HTML Meta Tags -->
		<title>OSM River Basins</title>
		<meta name="description" content="A unique, topological, view on rivers & waterways in OpenStreetMap, showing how they are connected. Find mistakes and make better maps.">

		<!-- Facebook Meta Tags -->
		<meta property="og:url" content="https://amandasaurus.github.io/osm-river-basins/">
		<meta property="og:type" content="website">
		<meta property="og:title" content="OSM River Basins">
		<meta property="og:description" content="A unique, topological, view on rivers & waterways in OpenStreetMap, showing how they are connected. Find mistakes and make better maps.">
		<meta property="og:image" content="./screenshot.png">

		<!-- Twitter Meta Tags -->
		<meta name="twitter:card" content="summary_large_image">
		<meta property="twitter:domain" content="amandasaurus.github.io">
		<meta property="twitter:url" content="https://amandasaurus.github.io/osm-river-basins/">
		<meta name="twitter:title" content="OSM River Basins">
		<meta name="twitter:description" content="A unique, topological, view on rivers & waterways in OpenStreetMap, showing how they are connected. Find mistakes and make better maps.">

		<!-- Meta Tags Generated via https://www.opengraph.xyz -->

		<link rel="icon" href="data:,">
        <link rel="stylesheet" href="maplibre-gl-2.4.0.css">
        <script src="maplibre-gl-2.4.0.js"></script>
        <script src="pmtiles-2.7.1.js"></script>
        <script src="alpine-3.12.3.js" defer></script>
		<script src="mapstyle.js"></script>
        <script src="setup.js"></script>
        <style>
            body {
                margin: 0;
				display: flex;
				flex-direction: column;
				height: 100vh;
            }
			header, footer {
				flex-grow: 0;
				flex-shrink: 0;
			}
			main {
				flex-grow: 1;
			}
            #map {
                height:100%; width:100%;
            }
        </style>
    </head>

	<body>
        <header>
		<h1>River Basins</h1>
		<p>This page shows connected ways from OpenStreetMap with the <code>waterway=river</code> tag for various area.s Data was proceed with <a href="https://github.com/amandasaurus/osm-lump-ways"><code>osm-lump-ways</code></a> and <a href="https://github.com/felt/tippecanoe"><code>tippecanoe</code></a>. Source for this project: <a href="https://github.com/amandasaurus/osm-river-basins">osm-river-basins on github</a>. Problems? <a href="mailto:Amanda McCann <amanda@technomancy.org>?subject=osm-river-basins%20contact">Email <code>amanda@technomancy.org</code></a>.</p>

		<p id="layer_switchers" x-data>
		<template x-if="!$store.tilesets_loaded"><span>⏳ Loading map please wait...</span></template>
			<template x-if="$store.tilesets_loaded">
			<template x-for="tileset in $store.tilesets.tilesets">
					<label>
						<input type=radio name=tiles :value="tileset.key" x-model="$store.tilesets.selected_tileset">
						<span x-html="tileset.text"></span>
					</label>
				</template>
			</template>
		</p>
		<p x-data>Colours on the map are randomly assigned.
			<button @click="map.setPaintProperty('waterway-line', 'line-color', ['match', ['%', ['get', 'root_wayid_120'], 2], 0, '#a6cee3', 1, '#1f78b4', 2, '#33a02c', 3, '#fb9a99', 4, '#e31a1c', 5, '#fdbf6f', 6, '#ff7f00', 7, '#cab2d6', 'black' ])">
				2 colours
			</button>
			<button @click="map.setPaintProperty('waterway-line', 'line-color', ['match', ['%', ['get', 'root_wayid_120'], 3], 0, '#a6cee3', 1, '#1f78b4', 2, '#33a02c', 3, '#fb9a99', 4, '#e31a1c', 5, '#fdbf6f', 6, '#ff7f00', 7, '#cab2d6', 'black' ])">
				3 colours
			</button>
			<button @click="map.setPaintProperty('waterway-line', 'line-color', ['match', ['%', ['get', 'root_wayid_120'], 4], 0, '#a6cee3', 1, '#1f78b4', 2, '#33a02c', 3, '#fb9a99', 4, '#e31a1c', 5, '#fdbf6f', 6, '#ff7f00', 7, '#cab2d6', 'black' ])">
				4 colours
			</button>
			<button @click="map.setPaintProperty('waterway-line', 'line-color', ['match', ['%', ['get', 'root_wayid_120'], 5], 0, '#a6cee3', 1, '#1f78b4', 2, '#33a02c', 3, '#fb9a99', 4, '#e31a1c', 5, '#fdbf6f', 6, '#ff7f00', 7, '#cab2d6', 'black' ])">
				5 colours
			</button>
			<button @click="map.setPaintProperty('waterway-line', 'line-color', ['match', ['%', ['get', 'root_wayid_120'], 6], 0, '#a6cee3', 1, '#1f78b4', 2, '#33a02c', 3, '#fb9a99', 4, '#e31a1c', 5, '#fdbf6f', 6, '#ff7f00', 7, '#cab2d6', 'black' ])">
				6 colours
			</button>
			<button @click="map.setPaintProperty('waterway-line', 'line-color', ['match', ['%', ['get', 'root_wayid_120'], 7], 0, '#a6cee3', 1, '#1f78b4', 2, '#33a02c', 3, '#fb9a99', 4, '#e31a1c', 5, '#fdbf6f', 6, '#ff7f00', 7, '#cab2d6', 'black' ])">
				7 colours
			</button>
		</p>

		<div
				x-data="{min_filter_enabled: false, min_filter: 0, min_filter_unit: 'km', max_filter_enabled: false, max_filter: 0, max_filter_unit: 'km', }"
				x-init="let hsh = new URLSearchParams((location.hash ?? '#').substr(1));
						min_filter_enabled = hsh.has('min_len'); min_filter = hsh.get('min_len') ?? 0; min_filter_unit = hsh.get('min_len_unit') ?? min_filter_unit;
						max_filter_enabled = hsh.has('max_len'); max_filter = hsh.get('max_len') ?? 0; min_filter_unit = hsh.get('min_len_unit') ?? min_filter_unit;

						let vars_to_watch = ['min_filter_enabled', 'min_filter', 'min_filter_unit', 'max_filter_enabled', 'max_filter', 'max_filter_unit'];
						for (let var_to_watch of vars_to_watch) {
							$watch(var_to_watch, _ => filterParamsChanged(min_filter_enabled, min_filter, min_filter_unit, max_filter_enabled, max_filter, max_filter_unit));
						}
				"
				>
				Exclude based on length:
				<label for=min_filter_enabled>
					<input id=min_filter_enabled type=checkbox x-model="min_filter_enabled" />
					Min. length
					<input :disabled="!min_filter_enabled" type=number x-model.number.debounce="min_filter" size=6 />
					<select x-model=min_filter_unit><option>m</option><option>km</option></select>
				</label>
				<label for=max_filter_enabled>
					<input id=max_filter_enabled type=checkbox x-model="max_filter_enabled" />
					Max. length
					<input :disabled="!max_filter_enabled" type=number x-model.number.debounce="max_filter" size=6 />
					<select x-model=max_filter_unit><option>m</option><option>km</option></select>
				</label>
		</div>

		<div>This area:
			<button x-data
					style="display: inline-flex; flex-direction: row; align-items: center; gap: 0.2ch;"
					@click="let url = `https://www.openstreetmap.org/#map=${Math.round(map.getZoom())}/${map.getBounds().getCenter().lat}/${map.getBounds().getCenter().lng}`; window.open(url);"
					@auxclick="let url = `https://www.openstreetmap.org/#map=${Math.round(map.getZoom())}/${map.getBounds().getCenter().lat}/${map.getBounds().getCenter().lng}`; window.open(url);"
					>
					view on osm.org <img src="open_ext.svg" style="height: 1em" />
			</button>
				<button x-data=""
						style="display: inline-flex; flex-direction: row; align-items: center; gap: 0.2ch;"
						@click="let current_url = location.protocol + '//' + location.host + location.pathname+location.search ;
								let b = map.getBounds();
								let url = `http://127.0.0.1:8111/load_and_zoom?top=${b.getNorth()}&amp;bottom=${b.getSouth()}&amp;left=${b.getWest()}&amp;right=${b.getEast()}&amp;new_layer=true&amp;changeset_source=${current_url}&amp;changeset_hashtags=%23RiverMapping`;
								this.disabled = true;
								fetch(url);
								this.disabled = false;"
					>
				edit area in josm <img src="open_ext.svg" style="height: 1em" />
			</button>
		</div>
		</header>

		<main>
			<div id="map"></div>
		</main>

		<footer>
			Map Data <a href="https://www.openstreetmap.org">© OpenStreetMap contributors</a>, under the <a href="https://www.openstreetmap.org/copyright">ODbL</a>.
		</footer>

    </body>
</html>
